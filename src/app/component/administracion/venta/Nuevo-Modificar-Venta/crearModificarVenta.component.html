<section>
    <br>
    <mat-card class="example-card" style="background: #F2F1E9">
        <mat-progress-bar *ngIf="loaderActualizar" mode="indeterminate"></mat-progress-bar>

        <div style="overflow-x:auto; ">
            <mat-progress-bar *ngIf="loaderCargaDatos" mode="indeterminate"></mat-progress-bar>

            <table>
                <tr>

                </tr>
            </table>

            <table style="width: 100%;">
                <th>

                </th>
                <th>
                    <div class="opcion1fd">
                        <h3> <strong>NUEVA VENTA</strong></h3>
                    </div>
                </th>
                <th>
                    <mat-form-field appearance="outline" style="width: 180px;"  [formGroup]="formGrupoTipoPago">
                        <mat-label>TIPO PAGO</mat-label>
                        <mat-select  formControlName="pago">
                            <mat-option *ngFor="let option2 of tipoPagoLista"
                                [value]="option2.id">{{option2.descripcion}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </th>
            </table>

            <h4>DATOS DE CLIENTE</h4>


            <table [formGroup]="formCliente">
                <mat-progress-bar *ngIf="loaderActualizarCedula" mode="indeterminate"></mat-progress-bar>
                <tr>

                    <td style="width: 30%">
                        <mat-form-field appearance="outline" style="width: 60%;">
                            <mat-label>Cédula</mat-label>
                            <input matInput formControlName="cedula">
                        </mat-form-field>

                        <button class="botontabla" mat-flat-button color="primary" style="width: 5%;"
                            (click)="buscarCliente()">
                            <mat-icon>find_replace</mat-icon></button>
                    </td>

                    <td style="width: 25%">

                        <mat-form-field appearance="outline">
                            <mat-label>Cliente</mat-label>
                            <input matInput formControlName="nombre" readonly>
                        </mat-form-field>
                    </td>

                    <td style="width: 20%">
                        <mat-form-field appearance="outline">
                            <mat-label>Dirección</mat-label>
                            <input matInput formControlName="direccion" readonly>
                        </mat-form-field>
                    </td>

                    <td style="width: 20%">
                        <mat-form-field appearance="outline">
                            <mat-label>Correo</mat-label>
                            <input matInput formControlName="correo" readonly>
                        </mat-form-field>
                    </td>
                    <td style="width: 10%">
                        <mat-form-field appearance="outline">
                            <mat-label>Telefóno</mat-label>
                            <input matInput formControlName="telefono" readonly>
                        </mat-form-field>
                    </td>

                </tr>


            </table>

            <table>

                <tr [formGroup]="formGrupoCodigoProducto">
                    <td>
                        <mat-form-field appearance="outline">
                            <mat-label>Código Barra Producto</mat-label>
                            <input matInput (input)="onSearchChange()" formControlName="codigopt">
                        </mat-form-field>
                    </td>
                    <td>

                    </td>
                    <td>

                    </td>
                    <td>

                    </td>
                    <td>
                        <mat-form-field appearance="outline">
                            <mat-label>Código Barra Producción</mat-label>
                            <input matInput (input)="onSearchChangeProduccion()" formControlName="codigopt">
                        </mat-form-field>
                    </td>
                    <td>

                    </td>
                    <td>

                    </td>
                    <td>

                    </td>
                </tr>

            </table>

            <table>
                <tr>

                    <td [formGroup]="forGrupoProducto" style="width: 50%;">
                        <table>
                            <tr>
                                <td>
                                    <mat-form-field appearance="outline" style="width: 180px;">
                                        <mat-label>Seleccione Producto</mat-label>
                                        <mat-select (selectionChange)=" productoAgregar()" formControlName="producto">
                                            <mat-option *ngFor="let option2 of productoLista"
                                                [value]="option2.codigoBarra">{{option2.nombre}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </td>

                                <td style="width: 33px;">
                                    <mat-form-field appearance="outline" style="width: 180px;"
                                        *ngIf="controlArticulos==true">
                                        <mat-label>Cantidad</mat-label>
                                        <input matInput required pattern="^[0-9]{0,12}([.][0-9]{2,2})?$"
                                            formControlName="cantidad">
                                    </mat-form-field>
                                </td>

                                <td style="width: 33px; text-align: left;" *ngIf="controlArticulos==true">
                                    <mat-form-field appearance="outline" style="width: 180px;"
                                        *ngIf="controlArticulos==true">
                                        <mat-label>Precio</mat-label>
                                        <input matInput required pattern="^[0-9]{0,12}([.][0-9]{2,2})?$"
                                            formControlName="precio">
                                    </mat-form-field>
                                </td>

                                <td style="width: 33px; text-align: left;" *ngIf="controlArticulos==true">
                                    <button [disabled]="forGrupoProducto.invalid " *ngIf="controlArticulos==true"
                                        mat-flat-button style="width: 33px; text-align: left;" color="primary"
                                        style="color: #FFFFFF; " class=".buttonguardar"
                                        (click)="calculartotalArticulo(1)">
                                        <mat-icon>add_circle_outline</mat-icon>
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </td>

                    <td [formGroup]="forGrupoProduccion" style="width: 50%;">
                        <table>
                            <tr>
                                <td>
                                    <mat-form-field appearance="outline" style="width: 180px;">
                                        <mat-label>Seleccione Producción</mat-label>
                                        <mat-select (selectionChange)=" produccionAgregar()"
                                            formControlName="productop">
                                            <mat-option *ngFor="let option2 of produccionLista"
                                                [value]="option2.codigoBarra">{{option2.nombre}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </td>

                                <td style="width: 33px;">
                                    <mat-form-field appearance="outline" style="width: 180px;"
                                        *ngIf="controlProduccion==true">
                                        <mat-label>Cantidad</mat-label>
                                        <input matInput required pattern="^[0-9]{0,12}([.][0-9]{2,2})?$"
                                            formControlName="cantidadp">
                                    </mat-form-field>
                                </td>

                                <td style="width: 33px; text-align: left;" *ngIf="controlProduccion==true">
                                    <mat-form-field appearance="outline" style="width: 180px;"
                                        *ngIf="controlProduccion==true">
                                        <mat-label>Precio</mat-label>
                                        <input matInput required pattern="^[0-9]{0,12}([.][0-9]{2,2})?$"
                                            formControlName="preciop">
                                    </mat-form-field>
                                </td>

                                <td style="width: 33px; text-align: left;" *ngIf="controlProduccion==true">
                                    <button [disabled]="forGrupoProduccion.invalid " *ngIf="controlProduccion==true"
                                        mat-flat-button style="width: 33px; text-align: left;" color="primary"
                                        style="color: #FFFFFF; " class=".buttonguardar"
                                        (click)="calculartotalProduccion(2)">
                                        <mat-icon>add_circle_outline</mat-icon>
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </td>




                </tr>
            </table>

            <mat-progress-bar *ngIf="loaderActualizarTablam2" mode="indeterminate"></mat-progress-bar>
            <table mat-table [dataSource]="dataSource1" class="mat-elevation-z8 demo-table"
                style="background-color: #f2f8df;">
                <!-- Position Column -->

                <ng-container matColumnDef="codigo">
                    <th mat-header-cell *matHeaderCellDef> COD. </th>
                    <td mat-cell *matCellDef="let element"> {{element.idProducto}} </td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="tipo">
                    <th mat-header-cell *matHeaderCellDef> TIPO </th>
                    <td mat-cell *matCellDef="let element">

                        <div *ngIf="element.tipo==1">
                            PRODUCTO
                        </div>

                        <div *ngIf="element.tipo==2">
                            PRODUCCIÓN
                        </div>

                    </td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="descripcion">
                    <th mat-header-cell *matHeaderCellDef> DESCRIPCIÓN </th>
                    <td mat-cell *matCellDef="let element">
                        {{element.nombre}}
                    </td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="unitario">
                    <th mat-header-cell *matHeaderCellDef> P. UNITARIO </th>
                    <td mat-cell *matCellDef="let element">
                        {{element.precioUnitario.toFixed(2)}}
                    </td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="iva">
                    <th mat-header-cell *matHeaderCellDef> P. IVA </th>
                    <td mat-cell *matCellDef="let element">
                        ${{element.precioIva}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="cantidad">
                    <th mat-header-cell *matHeaderCellDef> CANT </th>
                    <td mat-cell *matCellDef="let element">
                        {{element.cantidad}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="total">
                    <th mat-header-cell *matHeaderCellDef> TOTAL </th>
                    <td mat-cell *matCellDef="let element">
                        ${{element.precioTotal}}
                    </td>
                </ng-container>


                <!-- Weight Column -->
                <ng-container matColumnDef="weight">
                    <th mat-header-cell *matHeaderCellDef> ACCIÓN </th>
                    <td mat-cell *matCellDef="let element">

                        <!--
                        <button class="botontabla" mat-flat-button color="primary"
                            (click)=" abrirEditarPrecio(element.idProducto, element.nombre)"><mat-icon>edit</mat-icon></button>
-->

                        <button class="botontabla" mat-flat-button color="warn"
                            (click)="removeData(element.codigoBarra , element.id)">
                            <mat-icon>delete_forever</mat-icon></button>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns1"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns1;"></tr>
            </table>

            <br>

            <form>

                <table class="tablastyle" style="width: 50%; margin: 0 auto;">
                    <thead>
                        <tr class="tablastyle">

                            <th class="tablastyle1">
                                <table class="default">
                                    <tr>
                                        <td>SUB TOTAL</td>
                                    </tr>

                                    <tr>
                                        <td>($)</td>
                                    </tr>

                                </table>
                            </th>

                            <th class="tablastyle1">

                                <table class="default">
                                    <tr>
                                        <td>IVA</td>
                                    </tr>

                                    <tr>
                                        <td>($)</td>
                                    </tr>

                                </table>
                            </th>

                            <th class="tablastyle1">

                                <table class="default">
                                    <tr>
                                        <td>DESCUENTO</td>
                                    </tr>

                                    <tr>
                                        <td>($)</td>
                                    </tr>

                                </table>
                            </th>

                            <th class="tablastyle1">

                                <table class="default">
                                    <tr>
                                        <td>TOTAL</td>
                                    </tr>

                                    <tr>
                                        <td>($)</td>
                                    </tr>

                                </table>
                            </th>
                        </tr>
                    </thead>

                    <tbody>


                        <tr style="text-align: center;">

                            <td class="tablastyle">
                                <h2>
                                    {{subtotalTabla}}
                                </h2>

                            </td>



                            <td class="tablastyle">
                                <h2>
                                    {{ivaTabla}}
                                </h2>


                            </td>

                            <td class="tablastyle">
                                <h2>
                                    {{descuentoTabla}}
                                </h2>


                            </td>


                            <td class="tablastyle">
                                <h2>
                                    {{totalTabla}}
                                </h2>


                            </td>

                        </tr>

                    </tbody>

                </table>
            </form>

            <br>
        </div>


        <div>
            <div>
                <div class="opcion1fd">
                    <mat-progress-bar *ngIf="loaderActualizar" mode="indeterminate"></mat-progress-bar>

                    <button [disabled]="formGrupoTipoPago.invalid " *ngIf="botonParaGuardar==true" mat-flat-button
                        color="primary" style="color: #FFFFFF;" class=".buttonguardar" (click)="guardarInformacion()">
                        <mat-icon>save</mat-icon> REGISTRAR
                    </button>



                    <button mat-raised-button mat-flat-button color="warn" class="buttonprincipales"
                        (click)="botonCancelarRegistro()" class="buttonguardar">
                        <mat-icon>close</mat-icon> CANCELAR
                    </button>
                </div>
            </div>
        </div>

    </mat-card>
</section>


<br>


<p-dialog [(visible)]="dialogoEditarPrecioProveedor" [style]="{width:'20vw'}" [draggable]="false" [baseZIndex]="10000"
    [modal]="true" styleClass="p-fluid">
    <ng-template pTemplate="content">
        <mat-card class="dialogo" style="background-color: rgb(251, 246, 246); text-align: center;">


            <form [formGroup]="formGroupPrecioProveedor">
                <mat-form-field appearance="outline">
                    <mat-label>Nombre</mat-label>
                    <input class="textoCentro" readonly="true" type="text" matInput formControlName="proveedor"
                        required>
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Cantidad</mat-label>
                    <input class="textoCentro" matInput formControlName="precio" required>
                </mat-form-field>

                <br>
                <br>
                <mat-grid-list cols="2" rowHeight="4:1">
                    <mat-grid-tile style="background-color: transparent;"> <button mat-button class="botonnaranja"
                            [disabled]="formGroupPrecioProveedor.invalid" (click)=" guardarEditar()"
                            (click)="dialogoEditarPrecioProveedor=false">GUARDAR</button></mat-grid-tile>
                    <mat-grid-tile style="background-color: transparent;"><button mat-raised-button color="accent"
                            (click)="dialogoEditarPrecioProveedor=false">CANCELAR</button></mat-grid-tile>

                </mat-grid-list>


            </form>
        </mat-card>
    </ng-template>

</p-dialog>